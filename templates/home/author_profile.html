{% extends 'home/index.html' %}
{% load static %}
{% block content %}
<style>
    .navbar-transparent {
        background-color: #fb641b !important;
    }
    .wrapper {
        background-color: #fff !important;
    }
    .contents {
        padding: 2rem 0;
        max-width: 900px;
        margin: 4rem auto;
        font-family: 'Georgia', serif;
    }
    .row {
        display: flex;
        justify-content: space-between;
    }
    .col-8 {
        flex: 0 0 66.6667%;
        max-width: 66.6667%;
        padding-right: 15px;
        padding-left: 15px;
        overflow-y: auto;
        max-height: 80vh;
    }
    .col-4 {
        flex: 0 0 33.3333%;
        max-width: 33.3333%;
        padding-right: 15px;
        padding-left: 15px;
        position: sticky;
        top: 2rem;
        height: fit-content;
    }
    .tab-content {
        margin-top: 1.5rem;
    }
    .tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        margin-bottom: 1.5rem;
    }
    .tabs a {
        padding: 0.5rem 1rem;
        text-decoration: none;
        color: #333;
        border-bottom: 2px solid transparent;
        margin-right: 1rem;
        font-weight: bold;
        cursor: pointer;
    }
    .tabs a.active {
        border-bottom: 2px solid #fb641b;
        color: #fb641b;
    }
    h2 {
        font-size: 2rem;
        color: #333;
        margin-bottom: 2rem;
    }
    .author-details {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .author-details img {
        border-radius: 50%;
        width: 100px;
        height: 100px;
        object-fit: cover;
        margin-bottom: 1rem;
    }
    .author-details h3 {
        font-size: 1.5rem;
        margin: 0.5rem 0;
    }
    .author-details p {
        margin: 0.5rem 0;
        color: #666;
    }
    .author-details .follow-btn {
        display: inline-block;
        padding: 0.5rem 1rem;
        background-color: #fb641b;
        color: #fff;
        border-radius: 3px;
        text-decoration: none;
        margin-top: 1rem;
    }
    .author-details .follow-btn:hover {
        background-color: #e05a17;
    }
    /* Home Tab Content */
.blog-item {
    margin-bottom: 2rem;
    border-bottom: 1px solid #e0e0e0;
    padding-bottom: 1rem;
    position: relative;
}

.blog-item h3 {
    font-size: 1.6rem;
    color: #333;
    margin-bottom: 0.5rem;
}

.blog-item p {
    color: #666;
    font-size: 1.1rem;
    line-height: 1.6;
}

/* Blog Meta Section */
.blog-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9rem;
    color: #888;
    margin-top: 0.5rem;
}

.meta-left {
    display: flex;
    align-items: center;
}

.meta-left > div {
    display: flex;
    align-items: center;
    margin-right: 1rem;
}

.meta-left i {
    margin-right: 0.5rem;
    color: #fb641b; /* Color for icons */
}

.save-icon {
    font-size: 1.2rem;
    color: #fb641b;
    cursor: pointer;
}

.save-icon:hover {
    color: #e05a17; /* Color change on hover */
}
::-webkit-scrollbar {
    width: 0px !important;
}
</style>

<div class="contents">
    <h2>{{author | title}}</h2>
    <div class="row">
        <!-- Published Blogs Section -->
        <div class="col-8">
            <div class="tabs">
                <a href="#" data-target="#home" class="tab-link active">Home</a>
                <a href="#" data-target="#about" class="tab-link">About</a>
            </div>
            <div class="tab-content">
                <!-- Home Tab Content -->
                <div id="home" class="tab-pane active">
                    {% for story in stories %}
                    <div class="blog-item">
                        <a href="{% url 'blog' story.uuid %}"><h3>{{story.title}}</h3></a>
                        <p>{{story.subtitle}}</p>
                        <div class="blog-meta">
                            <div class="meta-left">
                                <div class="like-count">
                                    <i class="mdi mdi-thumb-up-outline"></i>
                                    <span>{{story.get_like_count}}</span>
                                </div>
                                <div class="comment-count">
                                    <i class="mdi mdi-comment-outline"></i>
                                    <span>{{story.get_comment_count}}</span>
                                </div>
                            </div>
    
                            {% if story.id in saved_story_ids %}
                                <i class="save-icon mdi mdi-bookmark" data-story-id="{{ story.id }}"></i> 
                            {% else %}
                                <i class="save-icon mdi mdi-bookmark-outline" data-story-id="{{ story.id }}"></i>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Add more blog items as needed -->
                </div>

                <!-- About Tab Content -->
                <div id="about" class="tab-pane">
                    <p>{{author.bio}}</p>
                    <p>{{author.website}}</p>
                    <hr>
                    <p>LinuxBro member since {{author.created_date | date }}Â·</p>
                </div>
            </div>
        </div>

        <!-- Author Details Section -->
        <div class="col-4">
            <div class="author-details">
                <img src="{% static 'images/profile.jpg' %}" alt="Author Profile Picture">
                <h3>{{author | title}}</h3>
                {%if author.sex == "M"%}
                <p>he/him</p>
                {% else %}
                <p>she/her</p>
                {% endif %}
                <p>{{author.follower_count}} Followers</p>
                <span>
                    <p>{{author.bio}}</p>
                    <a href="{{author.website}}" target="_blank">{{author.website}}</a>
                </span>
                {% if is_following %}
                <a href="#" class="follow-btn" data-author-id="{{ author.id }}">Following</a>
                {% else %}
                <a href="#" class="follow-btn" data-author-id="{{ author.id }}">Follow</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabLinks = document.querySelectorAll('.tab-link');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();

                // Remove active class from all tabs and tab panes
                tabLinks.forEach(link => link.classList.remove('active'));
                tabPanes.forEach(pane => pane.classList.remove('active'));

                // Add active class to the clicked tab and corresponding pane
                link.classList.add('active');
                const target = document.querySelector(link.getAttribute('data-target'));
                target.classList.add('active');
            });
        });
    });
</script>
{% endblock %}
{% block script %}
<script>
    $(document).ready(function() {
    $('.follow-btn').on('click', function(event) {
        event.preventDefault();
        const authorId = $(this).data('author-id');
        const csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
        const $this = $(this);

        $.ajax({
            url: "{% url 'follow-author' %}",
            type: "POST",
            data: {
                author_id: authorId,
                csrfmiddlewaretoken: csrfToken
            },
            success: function(response) {
                if (response.status === 'followed') {
                    $this.text('Following');
                } else if (response.status === 'unfollowed') {
                    $this.text('Follow');
                }
                $this.closest('.author-details').find('p:nth-child(4)').text(response.followers_count + ' Followers');
            },
            error: function(xhr, errmsg, err) {
                console.log('Error: ' + errmsg);
            }
        });
    });
    $('.save-icon').click(function() {
            var icon = $(this);
            var storyId = icon.data('story-id');

            $.ajax({
                type: 'POST',
                url: "{% url 'save-story' %}",  // Replace with your URL name for SaveStoryView
                data: {
                    'story_id': storyId,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.status === 'saved') {
                        icon.removeClass('mdi-bookmark-outline').addClass('mdi-bookmark');
                    } else if (response.status === 'unsaved') {
                        icon.removeClass('mdi-bookmark').addClass('mdi-bookmark-outline');
                    }
                },
                error: function(response) {
                    alert('An error occurred. Please try again.');
                }
            });
        });
});

</script>
{% endblock %}
